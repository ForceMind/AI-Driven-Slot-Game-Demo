# ⚙️ 配置文件参数详解 (Settings Explained)

本文档详细解释了 `game_config_v2.json` 中 `settings` 部分各个参数在代码中的实际作用。

---

## 1. `high_roller_threshold` (豪客门槛)
*   **当前值**: `50`
*   **代码位置**: `backend/outcome_engine.py` -> `_select_bucket`
*   **作用**: **下注门槛限制**。
    *   如果玩家的单次下注金额 (`bet`) **小于** 这个值（例如下注 10），代码会自动移除 `Win_Tier_4` (20-30倍) 和 `Win_Tier_5` (50-1000倍) 的中奖机会。
    *   这意味着小额玩家永远无法获得最高等级的大奖。
    *   *注：这是一个典型的商业诱导策略，用于促使玩家提高下注额。*

## 2. `max_historical_balance_buffer` (历史余额缓冲)
*   **当前值**: `1.2`
*   **代码位置**: **未使用** (仅存在于配置文件中)
*   **作用**: 这是一个预留参数，目前在后端代码中没有被引用。
    *   *设计初衷可能是为了在计算“最大历史余额”时提供一个浮动缓冲区，但实际逻辑中直接使用了 `max_win_ratio`。*

## 3. `max_win_ratio` (最大赢分倍率)
*   **当前值**: `1.1` (或 `1.2` 取决于版本)
*   **代码位置**: `backend/outcome_engine.py` -> `_select_bucket`
*   **作用**: **安全天花板 (Safety Ceiling)**。
    *   用于防止玩家余额无限增长，保护系统不被“击穿”。
    *   **公式**: `允许的最大余额 = 初始余额 * max_win_ratio`
    *   **逻辑**: 在决定发奖前，系统会计算：`当前余额 + 潜在奖金`。如果这个值超过了 `允许的最大余额`，系统会强制放弃该奖池，重新随机一个更小的奖或者直接判输。
    *   *例如：初始 1000，倍率 1.1，上限就是 1100。如果你现在 1050，想中一个 100 的奖（变 1150），系统会拒绝。*

## 4. `base_c_value` (基础 C 值)
*   **当前值**: `0.15`
*   **代码位置**: `backend/outcome_engine.py` -> `_select_bucket`
*   **作用**: **PRD 算法的核心常数**。
    *   控制中奖的基础概率。
    *   **公式**: `本次中奖概率 = base_c_value * (连输次数 + 1)`
    *   值越小，基础中奖率越低，需要连输更多次才能把概率叠加上去（高波动）。
    *   值越大，中奖越频繁，但通常配合低赔率（低波动）。

## 5. `target_rtp` (目标 RTP)
*   **当前值**: `0.97`
*   **代码位置**: `backend/llm_client.py` (主要用于 AI 上下文)
*   **作用**: **AI 的“人设”参考**，而非数值引擎的硬性约束。
    *   在 `outcome_engine.py` 的核心数学逻辑中，RTP 是由 `base_c_value` 和 `buckets` 的权重共同决定的，并没有直接使用这个 `target_rtp` 参数进行实时修正。
    *   这个参数主要传递给 LLM（大模型），告诉它：“现在的目标是控制在 97% 左右”。如果 AI 发现实际 RTP 远低于此，它可能会在生成的评论中更加鼓励玩家（虽然这只是口头上的）。

---

### 总结表

| 参数名 | 作用域 | 核心功能 | 备注 |
| :--- | :--- | :--- | :--- |
| `high_roller_threshold` | 数值引擎 | 限制小额玩家中大奖 | 商业诱导策略 |
| `max_historical_balance_buffer` | - | **未使用** | 冗余配置 |
| `max_win_ratio` | 数值引擎 | 限制玩家最大盈利上限 | 核心风控参数 |
| `base_c_value` | 数值引擎 | 决定中奖频率 (PRD) | 核心体验参数 |
| `target_rtp` | AI 模块 | 仅作为 AI 的参考上下文 | 不直接影响数值结果 |
